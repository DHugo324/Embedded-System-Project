C51 COMPILER V7.08   KEYSCAN                                                               05/27/2024 15:07:28 PAGE 1   


C51 COMPILER V7.08, COMPILATION OF MODULE KEYSCAN
OBJECT MODULE PLACED IN keyscan.OBJ
COMPILER INVOKED BY: C:\Keil\C51\BIN\C51.EXE keyscan.c BROWSE DEBUG OBJECTEXTEND

line level    source

   1          #include <reg52.h> // 包含標頭檔，一般情況不需要改動，標頭檔包含特殊功能寄存器
             -的定義
   2          #include "delay.h"
   3          #include "keyscan.h"
   4          
   5          #define KeyPort P1 // 定義鍵盤埠
   6          
   7          unsigned char KeyScan(void)  // 鍵盤掃瞄函數，使用行列逐級掃瞄法
   8          {
   9   1          unsigned char Val;
  10   1          KeyPort = 0xf0; // 高四位置高，低四位拉低
  11   1          if (KeyPort != 0xf0) // 表示有按鍵按下
  12   1          {
  13   2              DelayMs(10); // 去抖
  14   2              if (KeyPort != 0xf0) { // 表示有按鍵按下
  15   3                  KeyPort = 0xfe; // 檢測第一行
  16   3                  if (KeyPort != 0xfe) {
  17   4                      Val = KeyPort & 0xf0;
  18   4                      Val += 0x0e;
  19   4                      while (KeyPort != 0xfe);
  20   4                      DelayMs(10); // 去抖
  21   4                      while (KeyPort != 0xfe);
  22   4                      return Val;
  23   4                  }
  24   3                  KeyPort = 0xfd; // 檢測第二行
  25   3                  if (KeyPort != 0xfd) {
  26   4                      Val = KeyPort & 0xf0;
  27   4                      Val += 0x0d;
  28   4                      while (KeyPort != 0xfd);
  29   4                      DelayMs(10); // 去抖
  30   4                      while (KeyPort != 0xfd);
  31   4                      return Val;
  32   4                  }
  33   3                  KeyPort = 0xfb; // 檢測第三行
  34   3                  if (KeyPort != 0xfb) {
  35   4                      Val = KeyPort & 0xf0;
  36   4                      Val += 0x0b;
  37   4                      while (KeyPort != 0xfb);
  38   4                      DelayMs(10); // 去抖
  39   4                      while (KeyPort != 0xfb);
  40   4                      return Val;
  41   4                  }
  42   3                  KeyPort = 0xf7; // 檢測第四行
  43   3                  if (KeyPort != 0xf7) {
  44   4                      Val = KeyPort & 0xf0;
  45   4                      Val += 0x07;
  46   4                      while (KeyPort != 0xf7);
  47   4                      DelayMs(10); // 去抖
  48   4                      while (KeyPort != 0xf7);
  49   4                      return Val;
  50   4                  }
  51   3              }
  52   2          }
  53   1          return 0xff;
  54   1      }
C51 COMPILER V7.08   KEYSCAN                                                               05/27/2024 15:07:28 PAGE 2   

  55          
  56          unsigned char KeyPro(void) {
  57   1          switch (KeyScan()) {
  58   2          case 0x7e:return 0; break; // 0 按下相應的鍵顯示相對應的碼值
  59   2          case 0x7d:return 1; break; // 1
  60   2          case 0x7b:return 2; break; // 2
  61   2          case 0x77:return 3; break; // 3
  62   2          case 0xbe:return 4; break; // 4
  63   2          case 0xbd:return 5; break; // 5
  64   2          case 0xbb:return 6; break; // 6
  65   2          case 0xb7:return 7; break; // 7
  66   2          case 0xde:return 8; break; // 8
  67   2          case 0xdd:return 9; break; // 9
  68   2          case 0xdb:return 10; break; // a
  69   2          case 0xd7:return 11; break; // b
  70   2          case 0xee:return 12; break; // c
  71   2          case 0xed:return 13; break; // d
  72   2          case 0xeb:return 14; break; // e
  73   2          case 0xe7:return 15; break; // f
  74   2          default:return 0xff; break;
  75   2          }
  76   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    287    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =   ----       1
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
