C51 COMPILER V7.08   KEYSCAN                                                               06/09/2024 19:47:19 PAGE 1   


C51 COMPILER V7.08, COMPILATION OF MODULE KEYSCAN
OBJECT MODULE PLACED IN keyscan.OBJ
COMPILER INVOKED BY: C:\Keil\C51\BIN\C51.EXE keyscan.c BROWSE DEBUG OBJECTEXTEND

line level    source

   1          #include <reg52.h> // 包含標頭檔，一般情況不需要改動，標頭檔包含特殊功能寄存器的定義
   2          #include "delay.h"
   3          #include "keyscan.h"
   4          
   5          #define KeyPort P1 // 定義鍵盤埠
   6          
   7          unsigned char KeyScan(void) { // 鍵盤掃瞄函數，使用行列逐級掃瞄法
   8   1          unsigned char Val;
   9   1          KeyPort = 0xf0; // 高四位置高，低四位拉低
  10   1          if (KeyPort != 0xf0) // 表示有按鍵按下
  11   1          {
  12   2              DelayMs(10); // 去抖
  13   2              if (KeyPort != 0xf0) { // 表示有按鍵按下
  14   3                  KeyPort = 0xfe; // 檢測第一行
  15   3                  if (KeyPort != 0xfe) {
  16   4                      Val = KeyPort & 0xf0;
  17   4                      Val += 0x0e;
  18   4                      while (KeyPort != 0xfe);
  19   4                      DelayMs(10); // 去抖
  20   4                      while (KeyPort != 0xfe);
  21   4                      return Val;
  22   4                  }
  23   3                  KeyPort = 0xfd; // 檢測第二行
  24   3                  if (KeyPort != 0xfd) {
  25   4                      Val = KeyPort & 0xf0;
  26   4                      Val += 0x0d;
  27   4                      while (KeyPort != 0xfd);
  28   4                      DelayMs(10); // 去抖
  29   4                      while (KeyPort != 0xfd);
  30   4                      return Val;
  31   4                  }
  32   3                  KeyPort = 0xfb; // 檢測第三行
  33   3                  if (KeyPort != 0xfb) {
  34   4                      Val = KeyPort & 0xf0;
  35   4                      Val += 0x0b;
  36   4                      while (KeyPort != 0xfb);
  37   4                      DelayMs(10); // 去抖
  38   4                      while (KeyPort != 0xfb);
  39   4                      return Val;
  40   4                  }
  41   3                  KeyPort = 0xf7; // 檢測第四行
  42   3                  if (KeyPort != 0xf7) {
  43   4                      Val = KeyPort & 0xf0;
  44   4                      Val += 0x07;
  45   4                      while (KeyPort != 0xf7);
  46   4                      DelayMs(10); // 去抖
  47   4                      while (KeyPort != 0xf7);
  48   4                      return Val;
  49   4                  }
  50   3              }
  51   2          }
  52   1          return 0xff;
  53   1      }
  54          unsigned char KeyPro(void) {
  55   1          switch (KeyScan()) {
C51 COMPILER V7.08   KEYSCAN                                                               06/09/2024 19:47:19 PAGE 2   

  56   2          case 0x7e:return 1; break; // 1 按下相應的鍵顯示相對應的碼值
  57   2          case 0x7d:return 2; break; // 2
  58   2          case 0x7b:return 3; break; // 3
  59   2          case 0x77:return 4; break; // 4
  60   2          case 0xbe:return 5; break; // 5
  61   2          case 0xbd:return 6; break; // 6
  62   2          case 0xbb:return 7; break; // 7
  63   2          case 0xb7:return 8; break; // 8
  64   2          case 0xde:return 9; break; // 9
  65   2          case 0xdd:return 10; break; // A
  66   2          case 0xdb:return 11; break; // 
  67   2          case 0xd7:return 12; break; // 
  68   2          case 0xee:return 13; break; // 切換顯示
  69   2          case 0xed:return 14; break; // 
  70   2          case 0xeb:return 15; break; // 
  71   2          case 0xe7:return 16; break; // 確認/叫停
  72   2          default:return 0xff; break;
  73   2          }
  74   1      }
  75          


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    287    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =   ----       1
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
