C51 COMPILER V7.08   UART                                                                  05/27/2024 15:07:28 PAGE 1   


C51 COMPILER V7.08, COMPILATION OF MODULE UART
OBJECT MODULE PLACED IN uart.OBJ
COMPILER INVOKED BY: C:\Keil\C51\BIN\C51.EXE uart.c BROWSE DEBUG OBJECTEXTEND

line level    source

   1          #include <reg52.h> //包含標頭檔，一般情況不需要改動，標頭檔包含特殊功能寄存器的定義
   2          #include "uart.h"
   3          typedef unsigned char byte;
   4          typedef unsigned int  word;
   5          unsigned int max = 20;
   6          byte buf[20];
   7          byte head = 0;
*** WARNING C231 IN LINE 7 OF UART.C: 'head': redefinition
   8          byte get_0d = 0;
   9          byte rec_flag = 0;
  10          /*------------------------------------------------
  11          /*------------------------------------------------
  12                              串口初始化
  13          ------------------------------------------------*/
  14          void InitUART  (void)
  15          {
  16   1          SCON  = 0x50;                       // SCON: 模式 1, 8-bit UART, 使能接收  
  17   1          TMOD |= 0x20;               // TMOD: timer 1, mode 2, 8-bit 重裝
  18   1          TH1   = 0xFD;               // TH1:  重裝值 9600 串列傳輸速率 晶振 11.0592MHz  
  19   1          TR1   = 1;                  // TR1:  timer 1 打開                         
  20   1          EA    = 1;                  //打開總中斷
  21   1      }
  22          /*------------------------------------------------
  23                              發送一個位元組
  24          ------------------------------------------------*/
  25          void UART_SendByte(unsigned char dat)
  26          {
  27   1              SBUF = dat;
  28   1              while(!TI);
  29   1              TI = 0;
  30   1      }
  31          
  32          /*------------------------------------------------
  33                              發送一個字串
  34          ------------------------------------------------*/
  35          void UART_SendStr(unsigned char *s)
  36          {
  37   1              while(*s!='\0')// \0 表示字串結束標誌，通過檢測是否字串末尾
  38   1              {
  39   2                      UART_SendByte(*s);
  40   2                      if(*s=='\n')    //若結尾是換行符號也跳出
  41   2                              break;
  42   2                      s++;
  43   2              }
  44   1      }
  45          
  46          
  47          /*------------------------------------------------
  48                               串口中斷程式
  49          ------------------------------------------------*/
  50          void UART_SER (void) interrupt 4 //串列中斷服務程式
  51          {
  52   1          // 0x0d:'\r' 0x0a:'\n'
  53   1          unsigned char tmp;              //定義臨時變數 
  54   1          if (RI) {                       //判斷是接收中斷產生
C51 COMPILER V7.08   UART                                                                  05/27/2024 15:07:28 PAGE 2   

  55   2                      RI=0;                      //標誌位元清零
  56   2                      tmp=SBUF;                 //讀入緩衝區的值
  57   2              if (get_0d == 0) {
  58   3                  if (tmp == 0x0d) get_0d = 1;
  59   3                  else {
  60   4                      buf[head] = tmp;
  61   4                      head++;
  62   4                      if (head == MAX) head = 0;
  63   4                  }
  64   3              }
  65   2              else if (get_0d == 1) {
  66   3                  if (tmp != 0x0a) {
  67   4                      head = 0;
  68   4                      get_0d = 0;
  69   4                  }
  70   3                  else {
  71   4                      rec_flag = 1;
  72   4                      get_0d = 0;
  73   4                  }
  74   3              }
  75   2          }
  76   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    130    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =     25    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  1 WARNING(S),  0 ERROR(S)
